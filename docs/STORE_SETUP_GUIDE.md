# ストア設定ガイド - Google Play Console / App Store Connect

## 概要

Morizo Mobileアプリのサブスクリプション商品をGoogle Play ConsoleとApp Store Connectに登録する詳細手順です。

**作成日**: 2025年1月29日  
**バージョン**: 1.0  
**対象**: Google Play Console / App Store Connect

---

## アプリ情報

### 基本情報

- **アプリ名**: Morizo Mobile
- **iOS Bundle ID**: `jp.co.csngrp.morizo`
- **Android Package名**: `jp.co.csngrp.morizo`

### 商品IDの命名規則

**推奨商品ID**:
- `morizo_pro_monthly` - Morizo PRO（月額）
- `morizo_pro_yearly` - Morizo PRO（年額）
- `morizo_ultimate_monthly` - Morizo ULTIMATE（月額）
- `morizo_ultimate_yearly` - Morizo ULTIMATE（年額）

**命名規則**:
- 小文字とアンダースコアのみ使用
- プランタイプ（pro, ultimate）を含める
- 期間（monthly, yearly）を含める
- iOS/Androidで同じ商品IDを使用（推奨）

---

## 1. Google Play Console 設定手順

### 1.1 前提条件

- Google Play Consoleアカウント
- 開発者登録が完了していること
- アプリがGoogle Play Consoleに登録されていること

### 1.2 サブスクリプション商品の登録

#### ステップ1: 定期購入商品の作成

1. **Google Play Console**にログイン
   - URL: https://play.google.com/console
2. **アプリを選択** → Morizo Mobileを選択
3. **左メニュー** → **収益化** → **定期購入** をクリック
4. **定期購入商品を作成** ボタンをクリック

#### ステップ2: 商品IDの設定

**重要**: 商品IDは変更が困難なため、慎重に決定してください。

**商品1: Morizo PRO（月額）**

| 項目 | 値 |
|------|-----|
| **商品ID** | `morizo_pro_monthly` |
| **名前** | Morizo PRO |
| **説明** | 月額サブスクリプション。献立一括提案10回/日、段階的提案30回/日、OCR読み取り10回/日まで利用可能。 |
| **価格** | 設定値（例: ¥980/月） |
| **請求期間** | 1ヶ月 |

**商品2: Morizo PRO（年額）**

| 項目 | 値 |
|------|-----|
| **商品ID** | `morizo_pro_yearly` |
| **名前** | Morizo PRO（年額） |
| **説明** | 年額サブスクリプション。献立一括提案10回/日、段階的提案30回/日、OCR読み取り10回/日まで利用可能。 |
| **価格** | 設定値（例: ¥9,800/年） |
| **請求期間** | 1年 |

**商品3: Morizo ULTIMATE（月額）**

| 項目 | 値 |
|------|-----|
| **商品ID** | `morizo_ultimate_monthly` |
| **名前** | Morizo ULTIMATE |
| **説明** | 月額サブスクリプション。献立一括提案100回/日、段階的提案300回/日、OCR読み取り100回/日まで利用可能。 |
| **価格** | 設定値（例: ¥1,980/月） |
| **請求期間** | 1ヶ月 |

**商品4: Morizo ULTIMATE（年額）**

| 項目 | 値 |
|------|-----|
| **商品ID** | `morizo_ultimate_yearly` |
| **名前** | Morizo ULTIMATE（年額） |
| **説明** | 年額サブスクリプション。献立一括提案100回/日、段階的提案300回/日、OCR読み取り100回/日まで利用可能。 |
| **価格** | 設定値（例: ¥19,800/年） |
| **請求期間** | 1年 |

#### ステップ3: 詳細設定

各商品について、以下の設定を行います：

**必須設定項目**:
- ✅ **商品ID**: 上記の命名規則に従う
- ✅ **名前**: ユーザーに表示される商品名
- ✅ **説明**: 商品の詳細説明
- ✅ **価格**: 各ストアの通貨で設定（日本円: JPY）
- ✅ **請求期間**: 月額または年額

**オプション設定項目**:
- **無料トライアル期間**: 必要に応じて設定（例: 7日間）
- **プロモーション期間**: 必要に応じて設定
- **グレース期間**: 支払い失敗時の猶予期間（デフォルト: 3日間）

#### ステップ4: 商品の保存

1. 各設定項目を入力
2. **保存** ボタンをクリック
3. 商品が一覧に表示されることを確認

**注意**: 商品の作成後、審査が必要な場合があります。

---

### 1.3 テストアカウントの設定

サンドボックス環境でテストするために、テストアカウントを設定します。

#### ステップ1: ライセンステストの設定

1. **Google Play Console** → **設定** → **ライセンステスト** に移動
2. **ライセンステスト** セクションを開く

#### ステップ2: テストアカウントの追加

1. **テストアカウント** セクションで **アカウントを追加** をクリック
2. テスト用のGoogleアカウントのメールアドレスを入力
3. **保存** をクリック

**注意事項**:
- テストアカウントは最大20アカウントまで登録可能
- テストアカウントで購入した場合、実際の課金は発生しません
- テストアカウントで購入した商品は、24時間後に自動的にキャンセルされます

#### ステップ3: テストデバイスの設定

1. テスト用のAndroidデバイスにテストアカウントでログイン
2. Google Playストアでテストアカウントが有効になっていることを確認

---

### 1.4 商品IDの確認

設定完了後、以下の商品IDが正しく登録されていることを確認します：

- ✅ `morizo_pro_monthly`
- ✅ `morizo_pro_yearly`
- ✅ `morizo_ultimate_monthly`
- ✅ `morizo_ultimate_yearly`

**確認方法**:
1. **収益化** → **定期購入** に移動
2. 商品一覧で上記の商品IDが表示されていることを確認

---

## 2. App Store Connect 設定手順

### 2.1 前提条件

- App Store Connectアカウント
- Apple Developer Programへの登録が完了していること
- アプリがApp Store Connectに登録されていること

### 2.2 サブスクリプショングループの作成

#### ステップ1: サブスクリプショングループの作成

1. **App Store Connect**にログイン
   - URL: https://appstoreconnect.apple.com
2. **マイApp** → Morizo Mobileを選択
3. **収益化** → **定期購入** に移動
4. **+** ボタンをクリック → **サブスクリプショングループを作成** を選択

#### ステップ2: グループ情報の設定

| 項目 | 値 |
|------|-----|
| **参照名** | Morizo Plans |
| **表示名** | Morizo Plans（ユーザーに表示される名前） |

**重要**: サブスクリプショングループは、ユーザーがプランを変更する際に使用されます。

#### ステップ3: グループの保存

1. 設定を入力
2. **作成** ボタンをクリック
3. グループが一覧に表示されることを確認

---

### 2.3 サブスクリプション商品の登録

#### ステップ1: 定期購入商品の作成

1. 作成したサブスクリプショングループ（Morizo Plans）を選択
2. **+** ボタンをクリック → **定期購入を作成** を選択

#### ステップ2: 商品IDの設定

**重要**: 商品IDは変更が困難なため、慎重に決定してください。Google Play Consoleと同じIDを使用することを推奨します。

**商品1: Morizo PRO（月額）**

| 項目 | 値 |
|------|-----|
| **商品ID** | `morizo_pro_monthly` |
| **参照名** | Morizo PRO |
| **表示名** | Morizo PRO |
| **説明** | 月額サブスクリプション。献立一括提案10回/日、段階的提案30回/日、OCR読み取り10回/日まで利用可能。 |
| **価格** | 設定値（例: ¥980/月） |
| **請求期間** | 1ヶ月 |

**商品2: Morizo PRO（年額）**

| 項目 | 値 |
|------|-----|
| **商品ID** | `morizo_pro_yearly` |
| **参照名** | Morizo PRO（年額） |
| **表示名** | Morizo PRO（年額） |
| **説明** | 年額サブスクリプション。献立一括提案10回/日、段階的提案30回/日、OCR読み取り10回/日まで利用可能。 |
| **価格** | 設定値（例: ¥9,800/年） |
| **請求期間** | 1年 |

**商品3: Morizo ULTIMATE（月額）**

| 項目 | 値 |
|------|-----|
| **商品ID** | `morizo_ultimate_monthly` |
| **参照名** | Morizo ULTIMATE |
| **表示名** | Morizo ULTIMATE |
| **説明** | 月額サブスクリプション。献立一括提案100回/日、段階的提案300回/日、OCR読み取り100回/日まで利用可能。 |
| **価格** | 設定値（例: ¥1,980/月） |
| **請求期間** | 1ヶ月 |

**商品4: Morizo ULTIMATE（年額）**

| 項目 | 値 |
|------|-----|
| **商品ID** | `morizo_ultimate_yearly` |
| **参照名** | Morizo ULTIMATE（年額） |
| **表示名** | Morizo ULTIMATE（年額） |
| **説明** | 年額サブスクリプション。献立一括提案100回/日、段階的提案300回/日、OCR読み取り100回/日まで利用可能。 |
| **価格** | 設定値（例: ¥19,800/年） |
| **請求期間** | 1年 |

#### ステップ3: 詳細設定

各商品について、以下の設定を行います：

**必須設定項目**:
- ✅ **商品ID**: 上記の命名規則に従う（Google Play Consoleと同じIDを使用）
- ✅ **参照名**: 内部管理用の名前
- ✅ **表示名**: ユーザーに表示される商品名
- ✅ **説明**: 商品の詳細説明
- ✅ **価格**: 各ストアの通貨で設定（日本円: JPY）
- ✅ **請求期間**: 月額または年額

**オプション設定項目**:
- **無料トライアル期間**: 必要に応じて設定（例: 7日間）
- **プロモーション期間**: 必要に応じて設定
- **紹介オファー**: 新規ユーザー向けの特別価格

#### ステップ4: 商品の保存

1. 各設定項目を入力
2. **保存** ボタンをクリック
3. 商品がグループ内に表示されることを確認

**注意**: 商品の作成後、審査が必要な場合があります。

---

### 2.4 サンドボックステストアカウントの設定

サンドボックス環境でテストするために、サンドボックステストアカウントを設定します。

#### ステップ1: サンドボックステスターの設定

1. **App Store Connect** → **ユーザーとアクセス** → **サンドボックステスター** に移動
2. **+** ボタンをクリック

#### ステップ2: テストアカウントの追加

1. 以下の情報を入力：
   - **名**: テスト用の名前
   - **姓**: テスト用の名字
   - **メールアドレス**: テスト用のApple ID（新規作成が必要な場合あり）
   - **パスワード**: テスト用のパスワード
   - **国/地域**: 日本
2. **招待** ボタンをクリック

**注意事項**:
- サンドボックス環境では、実際の課金は発生しません
- サンドボックステスターのアカウントは、本番環境のApp Storeでは使用できません
- テストアカウントで購入した商品は、サンドボックス環境でのみ有効です

#### ステップ3: テストデバイスの設定

1. テスト用のiOSデバイスでサンドボックステスターのApple IDでログイン
2. App Storeでサンドボックス環境が有効になっていることを確認

---

### 2.5 商品IDの確認

設定完了後、以下の商品IDが正しく登録されていることを確認します：

- ✅ `morizo_pro_monthly`
- ✅ `morizo_pro_yearly`
- ✅ `morizo_ultimate_monthly`
- ✅ `morizo_ultimate_yearly`

**確認方法**:
1. **収益化** → **定期購入** → **Morizo Plans** に移動
2. 商品一覧で上記の商品IDが表示されていることを確認

---

## 3. 設定完了後の確認事項

### 3.1 商品IDの統一確認

**重要**: iOS/Androidで同じ商品IDを使用していることを確認します。

| プラン | 商品ID | Google Play | App Store |
|--------|--------|-------------|-----------|
| PRO（月額） | `morizo_pro_monthly` | ✅ | ✅ |
| PRO（年額） | `morizo_pro_yearly` | ✅ | ✅ |
| ULTIMATE（月額） | `morizo_ultimate_monthly` | ✅ | ✅ |
| ULTIMATE（年額） | `morizo_ultimate_yearly` | ✅ | ✅ |

### 3.2 価格設定の確認

各プランの価格が適切に設定されていることを確認します。

**確認項目**:
- ✅ 月額プランの価格が設定されているか
- ✅ 年額プランの価格が設定されているか
- ✅ 通貨（日本円: JPY）が正しいか
- ✅ 価格が適切な範囲内か（ストアのガイドラインに準拠）

### 3.3 テスト環境の確認

サンドボックス環境でのテストが可能な状態になっていることを確認します。

**Google Play Console**:
- ✅ テストアカウントが登録されているか
- ✅ テストアカウントでログインできるか

**App Store Connect**:
- ✅ サンドボックステスターが登録されているか
- ✅ サンドボックステスターでログインできるか

---

## 4. 次のステップ

ストア設定が完了したら、以下のステップに進みます：

1. **商品IDの設定ファイル作成**
   - `config/subscription.ts` を作成
   - 上記の商品IDを設定ファイルに記述

2. **実装の開始**
   - IAPライブラリの導入
   - APIクライアントの実装
   - UI実装

3. **サンドボックス環境でのテスト**
   - 購入フローのテスト
   - レシート検証のテスト
   - プラン更新のテスト

詳細は以下のドキュメントを参照してください：
- [Phase3実装ガイド](./PHASE3_IMPLEMENTATION_GUIDE.md)
- [収益化機能実装プラン](./MONETIZATION_IMPLEMENTATION_PLAN.md)
- [収益化機能実装詳細注意事項](./MONETIZATION_IMPLEMENTATION_DETAILS.md)

---

## 5. トラブルシューティング

### 5.1 商品IDが変更できない

**原因**: 商品IDは一度作成すると変更できません。

**対処方法**:
- 商品IDを削除して再作成する必要があります
- ただし、既に購入されている商品は削除できません
- 新しい商品IDを使用する場合は、実装コードも更新する必要があります

### 5.2 テストアカウントで購入できない

**原因**: テストアカウントの設定が正しくない可能性があります。

**対処方法**:
- テストアカウントが正しく登録されているか確認
- テストデバイスにテストアカウントでログインしているか確認
- サンドボックス環境が有効になっているか確認

### 5.3 商品が表示されない

**原因**: 商品の審査が完了していない可能性があります。

**対処方法**:
- 商品の審査状況を確認
- 審査が完了するまで待つ
- 必要に応じて、App Store Connectサポートに問い合わせ

---

## 6. 参考資料

- [Google Play Console ヘルプ](https://support.google.com/googleplay/android-developer)
- [App Store Connect ヘルプ](https://help.apple.com/app-store-connect/)
- [Google Play Billing Documentation](https://developer.android.com/google/play/billing)
- [App Store In-App Purchase Documentation](https://developer.apple.com/in-app-purchase/)

---

**最終更新日**: 2025年1月29日

