# Google Play ライセンステストと製品版テストの違い

## 問題の概要

内部テストテスターが製品版アプリ（16(1.1.3)）をインストールしてサブスクリプション登録すると、テストカードで決済され、5分だけ有効になる（テストモード）という問題が発生しています。

## 原因

これは**正常な動作**です。Google Play Consoleの「ライセンステスト」に登録されたアカウントは、**製品版アプリをインストールしても常にテストモードで動作**します。

### ライセンステストアカウントの特徴

1. **テストモードで動作**
   - ライセンステストに登録されたアカウントは、製品版アプリでもテストモードで動作します
   - 実際の課金は発生しません
   - テストカードで決済されます
   - サブスクリプションは通常24時間後に自動的にキャンセルされます（5分の場合は特別な設定の可能性があります）

2. **内部テストトラックとの関係**
   - 内部テストトラックに参加しているテスターが、ライセンステストにも登録されている場合、製品版でもテストモードで動作します
   - これは、Google Play Billingの仕様によるものです

## 解決方法

### 方法1: ライセンステストに登録されていないアカウントでテスト

製品版の動作確認には、**ライセンステストに登録されていない通常のGoogleアカウント**を使用してください。

**手順**:
1. Google Play Console → **設定** → **ライセンステスト** を確認
2. テストしたいアカウントがライセンステストに登録されていないことを確認
3. そのアカウントで製品版アプリをインストール
4. サブスクリプション登録を実行

**注意**: この方法では、実際の課金が発生します。テスト用のクレジットカードを使用することを推奨します。

### 方法2: クローズドベータまたはオープンベータトラックを使用

製品版の動作確認には、クローズドベータまたはオープンベータトラックを使用することを推奨します。

**メリット**:
- ライセンステストに登録されていない通常のアカウントでテスト可能
- 製品版と同じ環境でテスト可能
- 実際の課金フローをテスト可能

**手順**:
1. Google Play Console → **リリース** → **テスト** → **クローズドベータ**（または**オープンベータ**）を選択
2. 新しいリリースを作成
3. テストトラックに製品版ビルドをアップロード
4. テスターを追加（ライセンステストに登録されていないアカウント）
5. テスターに製品版アプリをインストールしてもらう

### 方法3: ライセンステストアカウントを一時的に削除

製品版のテストが完了したら、ライセンステストアカウントを再度追加できます。

**手順**:
1. Google Play Console → **設定** → **ライセンステスト**
2. テストしたいアカウントを一時的に削除
3. 製品版アプリでテストを実行
4. テスト完了後、必要に応じて再度追加

**注意**: この方法は、テストアカウントの管理が煩雑になるため、推奨しません。

## テストモードと製品版の違い

| 項目 | テストモード（ライセンステスト） | 製品版 |
|------|--------------------------------|--------|
| **課金** | 実際の課金は発生しない | 実際の課金が発生する |
| **決済方法** | テストカード | 実際のクレジットカード |
| **サブスクリプション期間** | 通常24時間後に自動キャンセル（設定により異なる） | 実際の期間（例: 1ヶ月） |
| **レシート検証** | テストレシート | 実際のレシート |
| **アカウント設定** | ライセンステストに登録されたアカウント | 通常のGoogleアカウント |

## 推奨テストフロー

### 1. 開発・内部テスト段階
- **目的**: 機能テスト、購入フローのテスト
- **使用するトラック**: 内部テスト
- **使用するアカウント**: ライセンステストに登録されたアカウント
- **期待される動作**: テストモードで動作（課金なし）

### 2. 製品版テスト段階
- **目的**: 実際の課金フローのテスト、レシート検証のテスト
- **使用するトラック**: クローズドベータまたはオープンベータ
- **使用するアカウント**: ライセンステストに登録されていない通常のアカウント
- **期待される動作**: 製品版モードで動作（実際の課金あり）

### 3. 本番リリース
- **目的**: 一般ユーザーへの提供
- **使用するトラック**: 本番トラック
- **使用するアカウント**: すべてのユーザー
- **期待される動作**: 製品版モードで動作（実際の課金あり）

## よくある質問

### Q: 内部テストテスターが製品版をインストールしてもテストモードになるのは正常ですか？

**A**: はい、正常です。内部テストテスターがライセンステストにも登録されている場合、製品版アプリでもテストモードで動作します。

### Q: 製品版のテストにはどのトラックを使用すべきですか？

**A**: クローズドベータまたはオープンベータトラックを使用することを推奨します。これにより、ライセンステストに登録されていない通常のアカウントでテストできます。

### Q: ライセンステストアカウントを削除せずに製品版をテストできますか？

**A**: はい、ライセンステストに登録されていない通常のアカウントを使用することで、製品版をテストできます。

### Q: テストモードで5分だけ有効になるのは正常ですか？

**A**: 通常、テストモードのサブスクリプションは24時間後に自動的にキャンセルされます。5分の場合は、特別な設定（例: テスト期間の短縮設定）が行われている可能性があります。Google Play Consoleの設定を確認してください。

## 関連ドキュメント

- [ストア設定ガイド](./archive/monetization/STORE_SETUP_GUIDE.md)
- [収益化機能実装詳細](./archive/monetization/MONETIZATION_IMPLEMENTATION_DETAILS.md)
- [開発ビルドガイド](./DEVELOPMENT_BUILD_GUIDE.md)

---

**最終更新**: 2025年1月
**作成者**: AIエージェント協働チーム
